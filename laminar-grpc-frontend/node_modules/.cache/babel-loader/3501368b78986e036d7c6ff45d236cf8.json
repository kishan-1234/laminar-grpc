{"ast":null,"code":"/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n * @format\n */\n// flowlint ambiguous-object-type:error\n'use strict';\n\nvar RelayConcreteNode = require('../util/RelayConcreteNode');\n\nvar RelayFeatureFlags = require('../util/RelayFeatureFlags');\n\nvar RelayModernRecord = require('./RelayModernRecord');\n\nvar RelayStoreUtils = require('./RelayStoreUtils');\n\nvar cloneRelayHandleSourceField = require('./cloneRelayHandleSourceField');\n\nvar invariant = require(\"fbjs/lib/invariant\");\n\nvar _require = require('./TypeID'),\n    generateTypeID = _require.generateTypeID;\n\nvar CONDITION = RelayConcreteNode.CONDITION,\n    CLIENT_EXTENSION = RelayConcreteNode.CLIENT_EXTENSION,\n    DEFER = RelayConcreteNode.DEFER,\n    FRAGMENT_SPREAD = RelayConcreteNode.FRAGMENT_SPREAD,\n    INLINE_FRAGMENT = RelayConcreteNode.INLINE_FRAGMENT,\n    LINKED_FIELD = RelayConcreteNode.LINKED_FIELD,\n    MODULE_IMPORT = RelayConcreteNode.MODULE_IMPORT,\n    LINKED_HANDLE = RelayConcreteNode.LINKED_HANDLE,\n    SCALAR_FIELD = RelayConcreteNode.SCALAR_FIELD,\n    SCALAR_HANDLE = RelayConcreteNode.SCALAR_HANDLE,\n    STREAM = RelayConcreteNode.STREAM,\n    TYPE_DISCRIMINATOR = RelayConcreteNode.TYPE_DISCRIMINATOR;\nvar getStorageKey = RelayStoreUtils.getStorageKey,\n    getModuleOperationKey = RelayStoreUtils.getModuleOperationKey;\n\nfunction mark(recordSource, selector, references, operationLoader) {\n  var dataID = selector.dataID,\n      node = selector.node,\n      variables = selector.variables;\n  var marker = new RelayReferenceMarker(recordSource, variables, references, operationLoader);\n  marker.mark(node, dataID);\n}\n/**\n * @private\n */\n\n\nvar RelayReferenceMarker = /*#__PURE__*/function () {\n  function RelayReferenceMarker(recordSource, variables, references, operationLoader) {\n    this._operationLoader = operationLoader !== null && operationLoader !== void 0 ? operationLoader : null;\n    this._recordSource = recordSource;\n    this._references = references;\n    this._variables = variables;\n  }\n\n  var _proto = RelayReferenceMarker.prototype;\n\n  _proto.mark = function mark(node, dataID) {\n    this._traverse(node, dataID);\n  };\n\n  _proto._traverse = function _traverse(node, dataID) {\n    this._references.add(dataID);\n\n    var record = this._recordSource.get(dataID);\n\n    if (record == null) {\n      return;\n    }\n\n    this._traverseSelections(node.selections, record);\n  };\n\n  _proto._getVariableValue = function _getVariableValue(name) {\n    !this._variables.hasOwnProperty(name) ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'RelayReferenceMarker(): Undefined variable `%s`.', name) : invariant(false) : void 0;\n    return this._variables[name];\n  };\n\n  _proto._traverseSelections = function _traverseSelections(selections, record) {\n    var _this = this;\n\n    selections.forEach(function (selection) {\n      /* eslint-disable no-fallthrough */\n      switch (selection.kind) {\n        case LINKED_FIELD:\n          if (selection.plural) {\n            _this._traversePluralLink(selection, record);\n          } else {\n            _this._traverseLink(selection, record);\n          }\n\n          break;\n\n        case CONDITION:\n          var conditionValue = _this._getVariableValue(selection.condition);\n\n          if (conditionValue === selection.passingValue) {\n            _this._traverseSelections(selection.selections, record);\n          }\n\n          break;\n\n        case INLINE_FRAGMENT:\n          if (selection.abstractKey == null) {\n            var typeName = RelayModernRecord.getType(record);\n\n            if (typeName != null && typeName === selection.type) {\n              _this._traverseSelections(selection.selections, record);\n            }\n          } else if (RelayFeatureFlags.ENABLE_PRECISE_TYPE_REFINEMENT) {\n            var _typeName = RelayModernRecord.getType(record);\n\n            var typeID = generateTypeID(_typeName);\n\n            _this._references.add(typeID);\n\n            _this._traverseSelections(selection.selections, record);\n          } else {\n            _this._traverseSelections(selection.selections, record);\n          }\n\n          break;\n\n        case FRAGMENT_SPREAD:\n          !false ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'RelayReferenceMarker(): Unexpected fragment spread `...%s`, ' + 'expected all fragments to be inlined.', selection.name) : invariant(false) : void 0;\n\n        case LINKED_HANDLE:\n          // The selections for a \"handle\" field are the same as those of the\n          // original linked field where the handle was applied. Reference marking\n          // therefore requires traversing the original field selections against\n          // the synthesized client field.\n          //\n          // TODO: Instead of finding the source field in `selections`, change\n          // the concrete structure to allow shared subtrees, and have the linked\n          // handle directly refer to the same selections as the LinkedField that\n          // it was split from.\n          var handleField = cloneRelayHandleSourceField(selection, selections, _this._variables);\n\n          if (handleField.plural) {\n            _this._traversePluralLink(handleField, record);\n          } else {\n            _this._traverseLink(handleField, record);\n          }\n\n          break;\n\n        case DEFER:\n        case STREAM:\n          _this._traverseSelections(selection.selections, record);\n\n          break;\n\n        case SCALAR_FIELD:\n        case SCALAR_HANDLE:\n          break;\n\n        case TYPE_DISCRIMINATOR:\n          {\n            if (RelayFeatureFlags.ENABLE_PRECISE_TYPE_REFINEMENT) {\n              var _typeName2 = RelayModernRecord.getType(record);\n\n              var _typeID = generateTypeID(_typeName2);\n\n              _this._references.add(_typeID);\n            }\n\n            break;\n          }\n\n        case MODULE_IMPORT:\n          _this._traverseModuleImport(selection, record);\n\n          break;\n\n        case CLIENT_EXTENSION:\n          _this._traverseSelections(selection.selections, record);\n\n          break;\n\n        default:\n          selection;\n          !false ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'RelayReferenceMarker: Unknown AST node `%s`.', selection) : invariant(false) : void 0;\n      }\n    });\n  };\n\n  _proto._traverseModuleImport = function _traverseModuleImport(moduleImport, record) {\n    var operationLoader = this._operationLoader;\n    !(operationLoader !== null) ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'RelayReferenceMarker: Expected an operationLoader to be configured when using `@module`.') : invariant(false) : void 0;\n    var operationKey = getModuleOperationKey(moduleImport.documentName);\n    var operationReference = RelayModernRecord.getValue(record, operationKey);\n\n    if (operationReference == null) {\n      return;\n    }\n\n    var operation = operationLoader.get(operationReference);\n\n    if (operation != null) {\n      this._traverseSelections(operation.selections, record);\n    } // Otherwise, if the operation is not available, we assume that the data\n    // cannot have been processed yet and therefore isn't in the store to\n    // begin with.\n\n  };\n\n  _proto._traverseLink = function _traverseLink(field, record) {\n    var storageKey = getStorageKey(field, this._variables);\n    var linkedID = RelayModernRecord.getLinkedRecordID(record, storageKey);\n\n    if (linkedID == null) {\n      return;\n    }\n\n    this._traverse(field, linkedID);\n  };\n\n  _proto._traversePluralLink = function _traversePluralLink(field, record) {\n    var _this2 = this;\n\n    var storageKey = getStorageKey(field, this._variables);\n    var linkedIDs = RelayModernRecord.getLinkedRecordIDs(record, storageKey);\n\n    if (linkedIDs == null) {\n      return;\n    }\n\n    linkedIDs.forEach(function (linkedID) {\n      if (linkedID != null) {\n        _this2._traverse(field, linkedID);\n      }\n    });\n  };\n\n  return RelayReferenceMarker;\n}();\n\nmodule.exports = {\n  mark: mark\n};","map":{"version":3,"sources":["/Users/gayatri/work/laminar-grpc/frontend/node_modules/relay-runtime/lib/store/RelayReferenceMarker.js"],"names":["RelayConcreteNode","require","RelayFeatureFlags","RelayModernRecord","RelayStoreUtils","cloneRelayHandleSourceField","invariant","_require","generateTypeID","CONDITION","CLIENT_EXTENSION","DEFER","FRAGMENT_SPREAD","INLINE_FRAGMENT","LINKED_FIELD","MODULE_IMPORT","LINKED_HANDLE","SCALAR_FIELD","SCALAR_HANDLE","STREAM","TYPE_DISCRIMINATOR","getStorageKey","getModuleOperationKey","mark","recordSource","selector","references","operationLoader","dataID","node","variables","marker","RelayReferenceMarker","_operationLoader","_recordSource","_references","_variables","_proto","prototype","_traverse","add","record","get","_traverseSelections","selections","_getVariableValue","name","hasOwnProperty","process","env","NODE_ENV","_this","forEach","selection","kind","plural","_traversePluralLink","_traverseLink","conditionValue","condition","passingValue","abstractKey","typeName","getType","type","ENABLE_PRECISE_TYPE_REFINEMENT","_typeName","typeID","handleField","_typeName2","_typeID","_traverseModuleImport","moduleImport","operationKey","documentName","operationReference","getValue","operation","field","storageKey","linkedID","getLinkedRecordID","_this2","linkedIDs","getLinkedRecordIDs","module","exports"],"mappings":"AAAA;;;;;;;;;AASA;AACA;;AAEA,IAAIA,iBAAiB,GAAGC,OAAO,CAAC,2BAAD,CAA/B;;AAEA,IAAIC,iBAAiB,GAAGD,OAAO,CAAC,2BAAD,CAA/B;;AAEA,IAAIE,iBAAiB,GAAGF,OAAO,CAAC,qBAAD,CAA/B;;AAEA,IAAIG,eAAe,GAAGH,OAAO,CAAC,mBAAD,CAA7B;;AAEA,IAAII,2BAA2B,GAAGJ,OAAO,CAAC,+BAAD,CAAzC;;AAEA,IAAIK,SAAS,GAAGL,OAAO,CAAC,oBAAD,CAAvB;;AAEA,IAAIM,QAAQ,GAAGN,OAAO,CAAC,UAAD,CAAtB;AAAA,IACIO,cAAc,GAAGD,QAAQ,CAACC,cAD9B;;AAGA,IAAIC,SAAS,GAAGT,iBAAiB,CAACS,SAAlC;AAAA,IACIC,gBAAgB,GAAGV,iBAAiB,CAACU,gBADzC;AAAA,IAEIC,KAAK,GAAGX,iBAAiB,CAACW,KAF9B;AAAA,IAGIC,eAAe,GAAGZ,iBAAiB,CAACY,eAHxC;AAAA,IAIIC,eAAe,GAAGb,iBAAiB,CAACa,eAJxC;AAAA,IAKIC,YAAY,GAAGd,iBAAiB,CAACc,YALrC;AAAA,IAMIC,aAAa,GAAGf,iBAAiB,CAACe,aANtC;AAAA,IAOIC,aAAa,GAAGhB,iBAAiB,CAACgB,aAPtC;AAAA,IAQIC,YAAY,GAAGjB,iBAAiB,CAACiB,YARrC;AAAA,IASIC,aAAa,GAAGlB,iBAAiB,CAACkB,aATtC;AAAA,IAUIC,MAAM,GAAGnB,iBAAiB,CAACmB,MAV/B;AAAA,IAWIC,kBAAkB,GAAGpB,iBAAiB,CAACoB,kBAX3C;AAYA,IAAIC,aAAa,GAAGjB,eAAe,CAACiB,aAApC;AAAA,IACIC,qBAAqB,GAAGlB,eAAe,CAACkB,qBAD5C;;AAGA,SAASC,IAAT,CAAcC,YAAd,EAA4BC,QAA5B,EAAsCC,UAAtC,EAAkDC,eAAlD,EAAmE;AACjE,MAAIC,MAAM,GAAGH,QAAQ,CAACG,MAAtB;AAAA,MACIC,IAAI,GAAGJ,QAAQ,CAACI,IADpB;AAAA,MAEIC,SAAS,GAAGL,QAAQ,CAACK,SAFzB;AAGA,MAAIC,MAAM,GAAG,IAAIC,oBAAJ,CAAyBR,YAAzB,EAAuCM,SAAvC,EAAkDJ,UAAlD,EAA8DC,eAA9D,CAAb;AACAI,EAAAA,MAAM,CAACR,IAAP,CAAYM,IAAZ,EAAkBD,MAAlB;AACD;AACD;;;;;AAKA,IAAII,oBAAoB,GAAG,aAAa,YAAY;AAClD,WAASA,oBAAT,CAA8BR,YAA9B,EAA4CM,SAA5C,EAAuDJ,UAAvD,EAAmEC,eAAnE,EAAoF;AAClF,SAAKM,gBAAL,GAAwBN,eAAe,KAAK,IAApB,IAA4BA,eAAe,KAAK,KAAK,CAArD,GAAyDA,eAAzD,GAA2E,IAAnG;AACA,SAAKO,aAAL,GAAqBV,YAArB;AACA,SAAKW,WAAL,GAAmBT,UAAnB;AACA,SAAKU,UAAL,GAAkBN,SAAlB;AACD;;AAED,MAAIO,MAAM,GAAGL,oBAAoB,CAACM,SAAlC;;AAEAD,EAAAA,MAAM,CAACd,IAAP,GAAc,SAASA,IAAT,CAAcM,IAAd,EAAoBD,MAApB,EAA4B;AACxC,SAAKW,SAAL,CAAeV,IAAf,EAAqBD,MAArB;AACD,GAFD;;AAIAS,EAAAA,MAAM,CAACE,SAAP,GAAmB,SAASA,SAAT,CAAmBV,IAAnB,EAAyBD,MAAzB,EAAiC;AAClD,SAAKO,WAAL,CAAiBK,GAAjB,CAAqBZ,MAArB;;AAEA,QAAIa,MAAM,GAAG,KAAKP,aAAL,CAAmBQ,GAAnB,CAAuBd,MAAvB,CAAb;;AAEA,QAAIa,MAAM,IAAI,IAAd,EAAoB;AAClB;AACD;;AAED,SAAKE,mBAAL,CAAyBd,IAAI,CAACe,UAA9B,EAA0CH,MAA1C;AACD,GAVD;;AAYAJ,EAAAA,MAAM,CAACQ,iBAAP,GAA2B,SAASA,iBAAT,CAA2BC,IAA3B,EAAiC;AAC1D,KAAC,KAAKV,UAAL,CAAgBW,cAAhB,CAA+BD,IAA/B,CAAD,GAAwCE,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GAAwC5C,SAAS,CAAC,KAAD,EAAQ,kDAAR,EAA4DwC,IAA5D,CAAjD,GAAqHxC,SAAS,CAAC,KAAD,CAAtK,GAAgL,KAAK,CAArL;AACA,WAAO,KAAK8B,UAAL,CAAgBU,IAAhB,CAAP;AACD,GAHD;;AAKAT,EAAAA,MAAM,CAACM,mBAAP,GAA6B,SAASA,mBAAT,CAA6BC,UAA7B,EAAyCH,MAAzC,EAAiD;AAC5E,QAAIU,KAAK,GAAG,IAAZ;;AAEAP,IAAAA,UAAU,CAACQ,OAAX,CAAmB,UAAUC,SAAV,EAAqB;AACtC;AACA,cAAQA,SAAS,CAACC,IAAlB;AACE,aAAKxC,YAAL;AACE,cAAIuC,SAAS,CAACE,MAAd,EAAsB;AACpBJ,YAAAA,KAAK,CAACK,mBAAN,CAA0BH,SAA1B,EAAqCZ,MAArC;AACD,WAFD,MAEO;AACLU,YAAAA,KAAK,CAACM,aAAN,CAAoBJ,SAApB,EAA+BZ,MAA/B;AACD;;AAED;;AAEF,aAAKhC,SAAL;AACE,cAAIiD,cAAc,GAAGP,KAAK,CAACN,iBAAN,CAAwBQ,SAAS,CAACM,SAAlC,CAArB;;AAEA,cAAID,cAAc,KAAKL,SAAS,CAACO,YAAjC,EAA+C;AAC7CT,YAAAA,KAAK,CAACR,mBAAN,CAA0BU,SAAS,CAACT,UAApC,EAAgDH,MAAhD;AACD;;AAED;;AAEF,aAAK5B,eAAL;AACE,cAAIwC,SAAS,CAACQ,WAAV,IAAyB,IAA7B,EAAmC;AACjC,gBAAIC,QAAQ,GAAG3D,iBAAiB,CAAC4D,OAAlB,CAA0BtB,MAA1B,CAAf;;AAEA,gBAAIqB,QAAQ,IAAI,IAAZ,IAAoBA,QAAQ,KAAKT,SAAS,CAACW,IAA/C,EAAqD;AACnDb,cAAAA,KAAK,CAACR,mBAAN,CAA0BU,SAAS,CAACT,UAApC,EAAgDH,MAAhD;AACD;AACF,WAND,MAMO,IAAIvC,iBAAiB,CAAC+D,8BAAtB,EAAsD;AAC3D,gBAAIC,SAAS,GAAG/D,iBAAiB,CAAC4D,OAAlB,CAA0BtB,MAA1B,CAAhB;;AAEA,gBAAI0B,MAAM,GAAG3D,cAAc,CAAC0D,SAAD,CAA3B;;AAEAf,YAAAA,KAAK,CAAChB,WAAN,CAAkBK,GAAlB,CAAsB2B,MAAtB;;AAEAhB,YAAAA,KAAK,CAACR,mBAAN,CAA0BU,SAAS,CAACT,UAApC,EAAgDH,MAAhD;AACD,WARM,MAQA;AACLU,YAAAA,KAAK,CAACR,mBAAN,CAA0BU,SAAS,CAACT,UAApC,EAAgDH,MAAhD;AACD;;AAED;;AAEF,aAAK7B,eAAL;AACE,WAAC,KAAD,GAASoC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GAAwC5C,SAAS,CAAC,KAAD,EAAQ,iEAAiE,uCAAzE,EAAkH+C,SAAS,CAACP,IAA5H,CAAjD,GAAqLxC,SAAS,CAAC,KAAD,CAAvM,GAAiN,KAAK,CAAtN;;AAEF,aAAKU,aAAL;AACE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAIoD,WAAW,GAAG/D,2BAA2B,CAACgD,SAAD,EAAYT,UAAZ,EAAwBO,KAAK,CAACf,UAA9B,CAA7C;;AAEA,cAAIgC,WAAW,CAACb,MAAhB,EAAwB;AACtBJ,YAAAA,KAAK,CAACK,mBAAN,CAA0BY,WAA1B,EAAuC3B,MAAvC;AACD,WAFD,MAEO;AACLU,YAAAA,KAAK,CAACM,aAAN,CAAoBW,WAApB,EAAiC3B,MAAjC;AACD;;AAED;;AAEF,aAAK9B,KAAL;AACA,aAAKQ,MAAL;AACEgC,UAAAA,KAAK,CAACR,mBAAN,CAA0BU,SAAS,CAACT,UAApC,EAAgDH,MAAhD;;AAEA;;AAEF,aAAKxB,YAAL;AACA,aAAKC,aAAL;AACE;;AAEF,aAAKE,kBAAL;AACE;AACE,gBAAIlB,iBAAiB,CAAC+D,8BAAtB,EAAsD;AACpD,kBAAII,UAAU,GAAGlE,iBAAiB,CAAC4D,OAAlB,CAA0BtB,MAA1B,CAAjB;;AAEA,kBAAI6B,OAAO,GAAG9D,cAAc,CAAC6D,UAAD,CAA5B;;AAEAlB,cAAAA,KAAK,CAAChB,WAAN,CAAkBK,GAAlB,CAAsB8B,OAAtB;AACD;;AAED;AACD;;AAEH,aAAKvD,aAAL;AACEoC,UAAAA,KAAK,CAACoB,qBAAN,CAA4BlB,SAA5B,EAAuCZ,MAAvC;;AAEA;;AAEF,aAAK/B,gBAAL;AACEyC,UAAAA,KAAK,CAACR,mBAAN,CAA0BU,SAAS,CAACT,UAApC,EAAgDH,MAAhD;;AAEA;;AAEF;AACEY,UAAAA,SAAS;AACT,WAAC,KAAD,GAASL,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GAAwC5C,SAAS,CAAC,KAAD,EAAQ,8CAAR,EAAwD+C,SAAxD,CAAjD,GAAsH/C,SAAS,CAAC,KAAD,CAAxI,GAAkJ,KAAK,CAAvJ;AAlGJ;AAoGD,KAtGD;AAuGD,GA1GD;;AA4GA+B,EAAAA,MAAM,CAACkC,qBAAP,GAA+B,SAASA,qBAAT,CAA+BC,YAA/B,EAA6C/B,MAA7C,EAAqD;AAClF,QAAId,eAAe,GAAG,KAAKM,gBAA3B;AACA,MAAEN,eAAe,KAAK,IAAtB,IAA8BqB,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GAAwC5C,SAAS,CAAC,KAAD,EAAQ,0FAAR,CAAjD,GAAuJA,SAAS,CAAC,KAAD,CAA9L,GAAwM,KAAK,CAA7M;AACA,QAAImE,YAAY,GAAGnD,qBAAqB,CAACkD,YAAY,CAACE,YAAd,CAAxC;AACA,QAAIC,kBAAkB,GAAGxE,iBAAiB,CAACyE,QAAlB,CAA2BnC,MAA3B,EAAmCgC,YAAnC,CAAzB;;AAEA,QAAIE,kBAAkB,IAAI,IAA1B,EAAgC;AAC9B;AACD;;AAED,QAAIE,SAAS,GAAGlD,eAAe,CAACe,GAAhB,CAAoBiC,kBAApB,CAAhB;;AAEA,QAAIE,SAAS,IAAI,IAAjB,EAAuB;AACrB,WAAKlC,mBAAL,CAAyBkC,SAAS,CAACjC,UAAnC,EAA+CH,MAA/C;AACD,KAdiF,CAchF;AACF;AACA;;AAED,GAlBD;;AAoBAJ,EAAAA,MAAM,CAACoB,aAAP,GAAuB,SAASA,aAAT,CAAuBqB,KAAvB,EAA8BrC,MAA9B,EAAsC;AAC3D,QAAIsC,UAAU,GAAG1D,aAAa,CAACyD,KAAD,EAAQ,KAAK1C,UAAb,CAA9B;AACA,QAAI4C,QAAQ,GAAG7E,iBAAiB,CAAC8E,iBAAlB,CAAoCxC,MAApC,EAA4CsC,UAA5C,CAAf;;AAEA,QAAIC,QAAQ,IAAI,IAAhB,EAAsB;AACpB;AACD;;AAED,SAAKzC,SAAL,CAAeuC,KAAf,EAAsBE,QAAtB;AACD,GATD;;AAWA3C,EAAAA,MAAM,CAACmB,mBAAP,GAA6B,SAASA,mBAAT,CAA6BsB,KAA7B,EAAoCrC,MAApC,EAA4C;AACvE,QAAIyC,MAAM,GAAG,IAAb;;AAEA,QAAIH,UAAU,GAAG1D,aAAa,CAACyD,KAAD,EAAQ,KAAK1C,UAAb,CAA9B;AACA,QAAI+C,SAAS,GAAGhF,iBAAiB,CAACiF,kBAAlB,CAAqC3C,MAArC,EAA6CsC,UAA7C,CAAhB;;AAEA,QAAII,SAAS,IAAI,IAAjB,EAAuB;AACrB;AACD;;AAEDA,IAAAA,SAAS,CAAC/B,OAAV,CAAkB,UAAU4B,QAAV,EAAoB;AACpC,UAAIA,QAAQ,IAAI,IAAhB,EAAsB;AACpBE,QAAAA,MAAM,CAAC3C,SAAP,CAAiBuC,KAAjB,EAAwBE,QAAxB;AACD;AACF,KAJD;AAKD,GAfD;;AAiBA,SAAOhD,oBAAP;AACD,CA5LuC,EAAxC;;AA8LAqD,MAAM,CAACC,OAAP,GAAiB;AACf/D,EAAAA,IAAI,EAAEA;AADS,CAAjB","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n * @format\n */\n// flowlint ambiguous-object-type:error\n'use strict';\n\nvar RelayConcreteNode = require('../util/RelayConcreteNode');\n\nvar RelayFeatureFlags = require('../util/RelayFeatureFlags');\n\nvar RelayModernRecord = require('./RelayModernRecord');\n\nvar RelayStoreUtils = require('./RelayStoreUtils');\n\nvar cloneRelayHandleSourceField = require('./cloneRelayHandleSourceField');\n\nvar invariant = require(\"fbjs/lib/invariant\");\n\nvar _require = require('./TypeID'),\n    generateTypeID = _require.generateTypeID;\n\nvar CONDITION = RelayConcreteNode.CONDITION,\n    CLIENT_EXTENSION = RelayConcreteNode.CLIENT_EXTENSION,\n    DEFER = RelayConcreteNode.DEFER,\n    FRAGMENT_SPREAD = RelayConcreteNode.FRAGMENT_SPREAD,\n    INLINE_FRAGMENT = RelayConcreteNode.INLINE_FRAGMENT,\n    LINKED_FIELD = RelayConcreteNode.LINKED_FIELD,\n    MODULE_IMPORT = RelayConcreteNode.MODULE_IMPORT,\n    LINKED_HANDLE = RelayConcreteNode.LINKED_HANDLE,\n    SCALAR_FIELD = RelayConcreteNode.SCALAR_FIELD,\n    SCALAR_HANDLE = RelayConcreteNode.SCALAR_HANDLE,\n    STREAM = RelayConcreteNode.STREAM,\n    TYPE_DISCRIMINATOR = RelayConcreteNode.TYPE_DISCRIMINATOR;\nvar getStorageKey = RelayStoreUtils.getStorageKey,\n    getModuleOperationKey = RelayStoreUtils.getModuleOperationKey;\n\nfunction mark(recordSource, selector, references, operationLoader) {\n  var dataID = selector.dataID,\n      node = selector.node,\n      variables = selector.variables;\n  var marker = new RelayReferenceMarker(recordSource, variables, references, operationLoader);\n  marker.mark(node, dataID);\n}\n/**\n * @private\n */\n\n\nvar RelayReferenceMarker = /*#__PURE__*/function () {\n  function RelayReferenceMarker(recordSource, variables, references, operationLoader) {\n    this._operationLoader = operationLoader !== null && operationLoader !== void 0 ? operationLoader : null;\n    this._recordSource = recordSource;\n    this._references = references;\n    this._variables = variables;\n  }\n\n  var _proto = RelayReferenceMarker.prototype;\n\n  _proto.mark = function mark(node, dataID) {\n    this._traverse(node, dataID);\n  };\n\n  _proto._traverse = function _traverse(node, dataID) {\n    this._references.add(dataID);\n\n    var record = this._recordSource.get(dataID);\n\n    if (record == null) {\n      return;\n    }\n\n    this._traverseSelections(node.selections, record);\n  };\n\n  _proto._getVariableValue = function _getVariableValue(name) {\n    !this._variables.hasOwnProperty(name) ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'RelayReferenceMarker(): Undefined variable `%s`.', name) : invariant(false) : void 0;\n    return this._variables[name];\n  };\n\n  _proto._traverseSelections = function _traverseSelections(selections, record) {\n    var _this = this;\n\n    selections.forEach(function (selection) {\n      /* eslint-disable no-fallthrough */\n      switch (selection.kind) {\n        case LINKED_FIELD:\n          if (selection.plural) {\n            _this._traversePluralLink(selection, record);\n          } else {\n            _this._traverseLink(selection, record);\n          }\n\n          break;\n\n        case CONDITION:\n          var conditionValue = _this._getVariableValue(selection.condition);\n\n          if (conditionValue === selection.passingValue) {\n            _this._traverseSelections(selection.selections, record);\n          }\n\n          break;\n\n        case INLINE_FRAGMENT:\n          if (selection.abstractKey == null) {\n            var typeName = RelayModernRecord.getType(record);\n\n            if (typeName != null && typeName === selection.type) {\n              _this._traverseSelections(selection.selections, record);\n            }\n          } else if (RelayFeatureFlags.ENABLE_PRECISE_TYPE_REFINEMENT) {\n            var _typeName = RelayModernRecord.getType(record);\n\n            var typeID = generateTypeID(_typeName);\n\n            _this._references.add(typeID);\n\n            _this._traverseSelections(selection.selections, record);\n          } else {\n            _this._traverseSelections(selection.selections, record);\n          }\n\n          break;\n\n        case FRAGMENT_SPREAD:\n          !false ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'RelayReferenceMarker(): Unexpected fragment spread `...%s`, ' + 'expected all fragments to be inlined.', selection.name) : invariant(false) : void 0;\n\n        case LINKED_HANDLE:\n          // The selections for a \"handle\" field are the same as those of the\n          // original linked field where the handle was applied. Reference marking\n          // therefore requires traversing the original field selections against\n          // the synthesized client field.\n          //\n          // TODO: Instead of finding the source field in `selections`, change\n          // the concrete structure to allow shared subtrees, and have the linked\n          // handle directly refer to the same selections as the LinkedField that\n          // it was split from.\n          var handleField = cloneRelayHandleSourceField(selection, selections, _this._variables);\n\n          if (handleField.plural) {\n            _this._traversePluralLink(handleField, record);\n          } else {\n            _this._traverseLink(handleField, record);\n          }\n\n          break;\n\n        case DEFER:\n        case STREAM:\n          _this._traverseSelections(selection.selections, record);\n\n          break;\n\n        case SCALAR_FIELD:\n        case SCALAR_HANDLE:\n          break;\n\n        case TYPE_DISCRIMINATOR:\n          {\n            if (RelayFeatureFlags.ENABLE_PRECISE_TYPE_REFINEMENT) {\n              var _typeName2 = RelayModernRecord.getType(record);\n\n              var _typeID = generateTypeID(_typeName2);\n\n              _this._references.add(_typeID);\n            }\n\n            break;\n          }\n\n        case MODULE_IMPORT:\n          _this._traverseModuleImport(selection, record);\n\n          break;\n\n        case CLIENT_EXTENSION:\n          _this._traverseSelections(selection.selections, record);\n\n          break;\n\n        default:\n          selection;\n          !false ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'RelayReferenceMarker: Unknown AST node `%s`.', selection) : invariant(false) : void 0;\n      }\n    });\n  };\n\n  _proto._traverseModuleImport = function _traverseModuleImport(moduleImport, record) {\n    var operationLoader = this._operationLoader;\n    !(operationLoader !== null) ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'RelayReferenceMarker: Expected an operationLoader to be configured when using `@module`.') : invariant(false) : void 0;\n    var operationKey = getModuleOperationKey(moduleImport.documentName);\n    var operationReference = RelayModernRecord.getValue(record, operationKey);\n\n    if (operationReference == null) {\n      return;\n    }\n\n    var operation = operationLoader.get(operationReference);\n\n    if (operation != null) {\n      this._traverseSelections(operation.selections, record);\n    } // Otherwise, if the operation is not available, we assume that the data\n    // cannot have been processed yet and therefore isn't in the store to\n    // begin with.\n\n  };\n\n  _proto._traverseLink = function _traverseLink(field, record) {\n    var storageKey = getStorageKey(field, this._variables);\n    var linkedID = RelayModernRecord.getLinkedRecordID(record, storageKey);\n\n    if (linkedID == null) {\n      return;\n    }\n\n    this._traverse(field, linkedID);\n  };\n\n  _proto._traversePluralLink = function _traversePluralLink(field, record) {\n    var _this2 = this;\n\n    var storageKey = getStorageKey(field, this._variables);\n    var linkedIDs = RelayModernRecord.getLinkedRecordIDs(record, storageKey);\n\n    if (linkedIDs == null) {\n      return;\n    }\n\n    linkedIDs.forEach(function (linkedID) {\n      if (linkedID != null) {\n        _this2._traverse(field, linkedID);\n      }\n    });\n  };\n\n  return RelayReferenceMarker;\n}();\n\nmodule.exports = {\n  mark: mark\n};"]},"metadata":{},"sourceType":"script"}